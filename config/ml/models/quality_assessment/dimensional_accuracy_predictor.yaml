# Dimensional Accuracy Predictor Configuration
# Model for predicting dimensional accuracy of PBF-LBM parts

model:
  name: "dimensional_accuracy_predictor"
  version: "1.0.0"
  type: "regression"
  framework: "scikit-learn"
  
  architecture:
    algorithm: "GradientBoostingRegressor"
    parameters:
      n_estimators: 200
      max_depth: 8
      learning_rate: 0.1
      subsample: 0.8
      min_samples_split: 10
      min_samples_leaf: 4
      random_state: 42
      loss: "huber"
    
  input_features:
    # Process Parameters
    - name: "laser_power"
      type: "numerical"
      description: "Laser power setting (W)"
      range: [50.0, 1000.0]
    - name: "scan_speed"
      type: "numerical"
      description: "Laser scan speed (mm/s)"
      range: [100.0, 2000.0]
    - name: "hatch_spacing"
      type: "numerical"
      description: "Hatch spacing between scan lines (mm)"
      range: [0.05, 0.3]
    - name: "layer_thickness"
      type: "numerical"
      description: "Layer thickness (mm)"
      range: [0.02, 0.1]
    - name: "contour_speed"
      type: "numerical"
      description: "Contour scan speed (mm/s)"
      range: [50.0, 1000.0]
    - name: "contour_power"
      type: "numerical"
      description: "Contour laser power (W)"
      range: [25.0, 500.0]
    
    # Build Parameters
    - name: "build_orientation_x"
      type: "numerical"
      description: "Build orientation around X-axis (degrees)"
      range: [0.0, 360.0]
    - name: "build_orientation_y"
      type: "numerical"
      description: "Build orientation around Y-axis (degrees)"
      range: [0.0, 360.0]
    - name: "build_orientation_z"
      type: "numerical"
      description: "Build orientation around Z-axis (degrees)"
      range: [0.0, 360.0]
    - name: "support_density"
      type: "numerical"
      description: "Support structure density (%)"
      range: [0.0, 100.0]
    - name: "support_angle"
      type: "numerical"
      description: "Support structure angle (degrees)"
      range: [30.0, 90.0]
    
    # Geometry Features
    - name: "part_volume"
      type: "numerical"
      description: "Total part volume (mm³)"
      range: [1.0, 1000000.0]
    - name: "part_surface_area"
      type: "numerical"
      description: "Total part surface area (mm²)"
      range: [1.0, 100000.0]
    - name: "aspect_ratio"
      type: "numerical"
      description: "Part aspect ratio (max_dimension/min_dimension)"
      range: [1.0, 100.0]
    - name: "wall_thickness_min"
      type: "numerical"
      description: "Minimum wall thickness (mm)"
      range: [0.1, 50.0]
    - name: "overhang_area_ratio"
      type: "numerical"
      description: "Ratio of overhang area to total area"
      range: [0.0, 1.0]
    - name: "feature_size_min"
      type: "numerical"
      description: "Minimum feature size (mm)"
      range: [0.1, 100.0]
    
    # Material Properties
    - name: "material_type"
      type: "categorical"
      description: "Material type"
      categories: ["Ti6Al4V", "Inconel718", "AlSi10Mg", "316L", "CoCr", "MaragingSteel"]
    - name: "powder_particle_size_d50"
      type: "numerical"
      description: "50th percentile particle size (μm)"
      range: [20.0, 150.0]
    - name: "powder_density"
      type: "numerical"
      description: "Powder apparent density (g/cm³)"
      range: [1.0, 10.0]
    - name: "thermal_conductivity"
      type: "numerical"
      description: "Material thermal conductivity (W/m·K)"
      range: [1.0, 500.0]
    - name: "thermal_expansion"
      type: "numerical"
      description: "Material thermal expansion coefficient (1/K)"
      range: [1e-6, 50e-6]
    
    # Environmental Conditions
    - name: "chamber_temperature"
      type: "numerical"
      description: "Build chamber temperature (°C)"
      range: [20.0, 200.0]
    - name: "preheat_temperature"
      type: "numerical"
      description: "Powder bed preheat temperature (°C)"
      range: [20.0, 300.0]
    - name: "cooling_rate"
      type: "numerical"
      description: "Average cooling rate (°C/s)"
      range: [0.1, 1000.0]

  output_targets:
    - name: "dimensional_accuracy_x"
      description: "Dimensional accuracy in X direction (μm)"
      range: [0.0, 1000.0]
    - name: "dimensional_accuracy_y"
      description: "Dimensional accuracy in Y direction (μm)"
      range: [0.0, 1000.0]
    - name: "dimensional_accuracy_z"
      description: "Dimensional accuracy in Z direction (μm)"
      range: [0.0, 1000.0]
    - name: "surface_roughness_ra"
      description: "Average surface roughness Ra (μm)"
      range: [0.1, 50.0]
    - name: "form_tolerance"
      description: "Form tolerance deviation (μm)"
      range: [0.0, 500.0]

  training:
    dataset_path: "/data/training/dimensional_accuracy_dataset.csv"
    validation_split: 0.2
    test_split: 0.1
    cross_validation:
      method: "kfold"
      n_splits: 5
    metrics:
      primary: "neg_mean_squared_error"
      secondary: ["neg_mean_absolute_error", "r2", "explained_variance"]
    early_stopping:
      enabled: true
      patience: 20
      monitor: "val_neg_mean_squared_error"
    
  preprocessing:
    scaling:
      method: "standard_scaler"
      features: ["laser_power", "scan_speed", "hatch_spacing", "layer_thickness",
                "contour_speed", "contour_power", "build_orientation_x", "build_orientation_y",
                "build_orientation_z", "support_density", "support_angle", "part_volume",
                "part_surface_area", "aspect_ratio", "wall_thickness_min", "overhang_area_ratio",
                "feature_size_min", "powder_particle_size_d50", "powder_density",
                "thermal_conductivity", "thermal_expansion", "chamber_temperature",
                "preheat_temperature", "cooling_rate"]
    encoding:
      method: "one_hot_encoding"
      features: ["material_type"]
    feature_engineering:
      - name: "energy_density"
        formula: "laser_power / (scan_speed * hatch_spacing * layer_thickness)"
      - name: "contour_energy_density"
        formula: "contour_power / (contour_speed * layer_thickness)"
      - name: "build_complexity"
        formula: "overhang_area_ratio * aspect_ratio / wall_thickness_min"
      - name: "thermal_gradient"
        formula: "(laser_power * thermal_conductivity) / (scan_speed * layer_thickness)"
    feature_selection:
      method: "mutual_info_regression"
      k_best: 25
      
  validation:
    business_rules:
      - rule: "minimum_wall_thickness_check"
        condition: "wall_thickness_min < 0.5 AND predicted_accuracy > 100"
        action: "flag_for_review"
      - rule: "high_energy_density_warning"
        condition: "energy_density > 300 AND predicted_accuracy > 200"
        action: "suggest_parameter_adjustment"
      - rule: "overhang_accuracy_validation"
        condition: "overhang_area_ratio > 0.3 AND predicted_accuracy > 150"
        action: "recommend_support_optimization"

  deployment:
    inference_mode: "batch"
    batch_size: 16
    max_latency_ms: 10000
    model_format: "joblib"
    artifact_path: "/models/dimensional_accuracy_predictor/v1.0.0/"
    
  monitoring:
    drift_detection:
      enabled: true
      method: "ks_test"
      threshold: 0.05
      features: ["laser_power", "scan_speed", "energy_density", "layer_thickness"]
    performance_monitoring:
      enabled: true
      metrics: ["mse", "mae", "r2", "explained_variance"]
      alert_thresholds:
        mse: 10000.0
        mae: 50.0
        r2: 0.7
    explainability:
      enabled: true
      method: "shap"
      sample_size: 2000
      
  retraining:
    trigger: "performance_degradation"
    threshold: 0.1
    schedule: "monthly"
    data_requirements:
      min_samples: 1500
      material_balance_threshold: 0.1
      
  calibration:
    enabled: true
    method: "isotonic_regression"
    validation_split: 0.1
    recalibration_frequency: "weekly"
